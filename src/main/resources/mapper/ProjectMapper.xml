<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.bno2.mapper.ProjectMapper">

    <select id="selectProjectsByName" resultType="com.example.bno2.dto.Project">
        select
            uid as project_uid,
            project_name as projectName,
            start_dt as startDt,
            end_dt as endDt,
            start_predict_dt as startPredictDt,
            end_predict_dt as endPredictDt,
            project_state_code as stateCode,
            project_detail
        from
            project
        where
            uid !=1
        and
            (trim(project_name) like concat('%',#{projectName},'%') or #{projectName} is null )
    </select>

    <select id="selectProjectsByNameState" resultType="com.example.bno2.dto.Project">
        select
            uid,
            project_name as projectName,
            start_dt as startDt,
            end_dt as endDt,
            start_predict_dt as startPredictDt,
            end_predict_dt as endPredictDt,
            project_state_code as stateCode,
            project_detail
        from
            project
        where
            uid !=1
        and
            (trim(project_name) like concat('%',#{projectName},'%') or #{projectName} is null )
        and
            project_state_code = #{stateCode}
    </select>

    <insert id="insertProject" parameterType="map">
        insert into
            project(project_name,
                    start_dt,
                    end_dt,
                    start_predict_dt,
                    end_predict_dt,
                    project_state_code,
                    project_detail,
                    first_update_pn,
                    last_update_pn)
        values
            (#{project.projectName},
             #{project.startPredictDt},
             #{project.endPredictDt},
             #{project.startPredictDt},
             #{project.endPredictDt},
             #{project.stateCode},
             #{project.project_detail},
             #{loginUserPn},
             #{loginUserPn})
    </insert>

    <update id="updateProject" parameterType="map">
        update
            project
        set
            project_name = #{project.projectName},
            start_dt = #{project.startDt},
            end_dt = #{project.endDt},
            start_predict_dt = #{project.startPredictDt},
            end_predict_dt = #{project.endPredictDt},
            project_state_code = #{project.stateCode},
            project_detail = #{project.project_detail},
            last_update_pn = #{loginUserPn},
            last_update_dt = (NOW() + INTERVAL 9 HOUR)
        where
            uid = #{project.uid}
    </update>

</mapper>