<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.bno2.mapper.UserMapper">

    <select id="selectUsersByName" resultType="com.example.bno2.dto.User">
        SELECT
        pn,
        email,
        name,
        dept_code AS deptCode,
        con,
        pos_code AS posCode,
        state_code AS stateCode
        FROM
        user
        WHERE
        pn != 1
        AND (TRIM(name) LIKE CONCAT('%',TRIM(#{name}),'%') OR #{name} IS NULL)
        <if test="deptCode != null">
            AND dept_code = #{deptCode}
        </if>
        ORDER BY name
    </select>

    <insert id="insertUser" parameterType="map">
        INSERT INTO
            user(email,
                 name,
                 dept_code,
                 con,
                 pos_code,
                 state_code,
                 first_update_pn,
                 last_update_pn)
        VALUES
            (#{user.email},
             #{user.name},
             #{user.deptCode},
             #{user.con},
             #{user.posCode},
             #{user.stateCode},
             #{loginUserPn},
             #{loginUserPn})
    </insert>

    <update id="updateUser" parameterType="map">
        UPDATE
            user
        SET
            email = #{user.email},
            name = #{user.name},
            dept_code = #{user.deptCode},
            con = #{user.con},
            pos_code = #{user.posCode},
            state_code = #{user.stateCode},
            last_update_pn = #{loginUserPn},
            last_update_dt = (NOW() + INTERVAL 9 HOUR)
        WHERE
            pn = #{user.pn}
    </update>


</mapper>