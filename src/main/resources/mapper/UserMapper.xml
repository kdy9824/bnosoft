<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.bno2.mapper.UserMapper">

    <select id="selectUsersByName" resultType="com.example.bno2.dto.User">
        select
            pn,
            email,
            name,
            dept_code as deptCode,
            con,
            pos_code as posCode,
            state_code as stateCode
        from
            user
        where
            pn != 1 and
            (trim(name) like concat('%',trim(#{name}),'%') or #{name} is null)
        order by
            name
    </select>

    <select id="selectUsersByNameDept" resultType="com.example.bno2.dto.User">
        select
            pn,
            email,
            name,
            dept_code as deptCode,
            con,
            pos_code as posCode,
            state_code as stateCode
        from
            user
        where
            pn != 1 and
            (trim(name) like concat('%',trim(#{name}),'%') or #{name} is null)
          and
            dept_code = #{deptCode}
        order by
            name
    </select>

    <insert id="insertUser" parameterType="map">
        insert into
            user(email,
                 name,
                 dept_code,
                 con,
                 pos_code,
                 state_code,
                 first_update_pn,
                 last_update_pn)
        values
            (#{user.email},
             #{user.name},
             #{user.deptCode},
             #{user.con},
             #{user.posCode},
             #{user.stateCode},
             #{loginUserPn},
             #{loginUserPn})
    </insert>

    <update id="updateUser" parameterType="map">
        UPDATE
            user
        SET
            email = #{user.email},
            name = #{user.name},
            dept_code = #{user.deptCode},
            con = #{user.con},
            pos_code = #{user.posCode},
            state_code = #{user.stateCode},
            last_update_pn = #{loginUserPn},
            last_update_dt = (NOW() + INTERVAL 9 HOUR)
        where
            pn=#{user.pn}
    </update>


</mapper>